# 20230320
## ì˜¤ëŠ˜ ê³µë¶€í•œ ë‚´ìš©
## - ğŸ“‘ : Now In Android Deep Dive
# Day5 (2023.03.29)

datastoreë¶€ë¶„ì„ ì•Œì•„ë³´ì

ìš°ì„  datastoreëŠ” ë‘ê°€ì§€ë¡œ ë‚˜ë‰˜ëŠ”ë° **Preferences DataStore** ì™€ **Proto DataStore**ë¡œ ë‚˜ë‰œë‹¤. 

- **Preferences DataStore**ëŠ” í‚¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³  ë°ì´í„°ì— ì•¡ì„¸ìŠ¤í•©ë‹ˆë‹¤. ì´ êµ¬í˜„ì€ ìœ í˜• ì•ˆì „ì„±ì„ ì œê³µí•˜ì§€ ì•Šìœ¼ë©° ì‚¬ì „ ì •ì˜ëœ ìŠ¤í‚¤ë§ˆê°€ í•„ìš”í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
- **Proto Datastore**ëŠ” ë§ì¶¤ ë°ì´í„° ìœ í˜•ì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œ ë°ì´í„°ë¥¼ ì €ì¥í•©ë‹ˆë‹¤. ì´ êµ¬í˜„ì€ ìœ í˜• ì•ˆì „ì„±ì„ ì œê³µí•˜ë©°Â [í”„ë¡œí† ì½œ ë²„í¼](https://developers.google.com/protocol-buffers?hl=ko)ë¥¼ ì‚¬ìš©í•˜ì—¬ ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

ì§€ê¸ˆ niaì—ì„œëŠ” Protoë°©ì‹ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸ì— proto ë°©ì‹ìœ¼ë¡œ ë´ì•¼í•œë‹¤.

ì¼ë‹¨ protoëŠ” java ë””ë ‰í† ë¦¬ì— ë“¤ì–´ê°€ì§€ ì•Šê³  proto ë””ë ‰í† ë¦¬ì—ì„œ ë”°ë¡œ ê´€ë¦¬í•œë‹¤.

ì• ì´ˆì— ìë°”ë‚˜ ì½”í‹€ë¦°ë„ ì•„ë‹ˆê³  *.proto í˜•ì‹ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ë‹¤. 

## Proton

```protobuf
syntax = "proto3";

option java_package = "com.google.samples.apps.nowinandroid.core.datastore";
option java_multiple_files = true;

enum DarkThemeConfigProto {
DARK_THEME_CONFIG_UNSPECIFIED= 0;
DARK_THEME_CONFIG_FOLLOW_SYSTEM= 1;
DARK_THEME_CONFIG_LIGHT= 2;
DARK_THEME_CONFIG_DARK= 3;
}

```

syntaxëŠ” ì‚¬ìš©í•  proto ë²„ì „ì„ ì„¤ì •í•˜ê³  optionìœ¼ë¡œ ë§ê·¸ëŒ€ë¡œ ì˜µì…˜ì„ ì„¤ì •í•˜ëŠ”ë° java_packageë¡œ ì§€ê¸ˆ ë§Œë“  protoë¥¼ javaí´ë˜ìŠ¤ë¡œ ë°°ì¹˜í•˜ê²Œ ë  ìœ„ì¹˜ë¥¼ ì§€ì •í•˜ê²Œ ëœë‹¤.

java_multiple_filesëŠ” ìƒì„±ë˜ëŠ” javaíŒŒì¼ì„ ê° ë©”ì‹œì§€, enumë“± ë³„ë„ì˜ íŒŒì¼ë¡œ ìƒì„±í•˜ë„ë¡ í•œë‹¤.

enum ì•ˆì—ëŠ” datastoreì—ì„œ ì‚¬ìš©í•  í•„ë“œë¥¼ ì •ì˜í•œë‹¤.

```protobuf
syntax = "proto3";

option java_package = "com.google.samples.apps.nowinandroid.core.datastore";
option java_multiple_files = true;

enum ThemeBrandProto {
THEME_BRAND_UNSPECIFIED= 0;
THEME_BRAND_DEFAULT= 1;
THEME_BRAND_ANDROID= 2;
}

```

ìœ„ì˜ ì„¤ëª…ê³¼ ë™ì¼í•˜ê²Œ ë³´ë©´ ëœë‹¤.

```protobuf
syntax = "proto3";

import "com/google/samples/apps/nowinandroid/data/dark_theme_config.proto";
import "com/google/samples/apps/nowinandroid/data/theme_brand.proto";

option java_package = "com.google.samples.apps.nowinandroid.core.datastore";
option java_multiple_files = true;

message UserPreferences {
    reserved 2;
    repeated int32 deprecated_int_followed_topic_ids = 1;
    int32 topicChangeListVersion = 3;
    int32 authorChangeListVersion = 4;
    int32 newsResourceChangeListVersion = 6;
    repeated int32 deprecated_int_followed_author_ids = 7;
    bool has_done_int_to_string_id_migration = 8;
    repeated string deprecated_followed_topic_ids = 9;
    repeated string deprecated_followed_author_ids = 10;
    repeated string deprecated_bookmarked_news_resource_ids = 11;
    bool has_done_list_to_map_migration = 12;

    // Each map is used to store a set of string IDs. The bool has no meaning, but proto3 doesn't
    // have a Set type so this is the closest we can get to a Set.
    map<string, bool> followed_topic_ids = 13;
    map<string, bool> followed_author_ids = 14;
    map<string, bool> bookmarked_news_resource_ids = 15;

    ThemeBrandProto theme_brand = 16;
    DarkThemeConfigProto dark_theme_config = 17;

    bool should_hide_onboarding = 18;

    bool use_dynamic_color = 19;
}

```

importëŠ” ìš°ë¦¬ê°€ ì‚¬ìš©í•˜ë˜ ë°©ì‹ê³¼ ë™ì¼í•˜ê²Œ í•´ë‹¹ ê²½ë¡œì˜ íŒŒì¼ì„ ì°¸ì¡°í•˜ëŠ”ê²ƒì´ê³  `message` ë¥¼ í†µí•´ ì‹¤ì œ UserPreferencesê°€ ì‚¬ìš©í•  í•„ë“œë¥¼ ë§Œë“ ë‹¤.

reservedëŠ” ë¯¸ë¦¬ ì˜ˆì•½í•œ í•„ë“œë¡œ í™•ì¥ì„±ì„ ìœ„í•´ ë‘” í•„ë“œì´ê³  repeatedëŠ” ë¦¬ìŠ¤íŠ¸ ê°œë…ì´ë¼ê³  ìƒê°í•˜ë©´ í¸í•˜ë‹¤.

## Datastore

```kotlin
data class ChangeListVersions(
    val topicVersion: Int = -1,
    val newsResourceVersion: Int = -1,
)

```

í•´ë‹¹ í´ë˜ìŠ¤ëŠ” ì´ì „ dataë¶€ë¶„ì—ì„œ í•œë²ˆ ë´¤ëŠ”ë° ê°ê°ì˜ ë°ì´í„°ì˜ ë²„ì „ì„ ë°›ê¸°ìœ„í•œ data classì´ë‹¤. ì´ê±¸ datastoreì—ì„œ ê´€ë¦¬í•˜ëŠ” ì´ìœ ëŠ” datastoreì˜ UserPreferencesì—ì„œ í•´ë‹¹ ë°ì´í„°ë“¤ì„ ê´€ë¦¬í•˜ê¸° ë•Œë¬¸ì´ë‹¤.

```kotlin
/**
 * Migrates saved ids from[Int] to[String] types
 */
object IntToStringIdsMigration : DataMigration<UserPreferences> {

    override suspend fun cleanUp() = Unit

    override suspend fun migrate(currentData: UserPreferences): UserPreferences =
        currentData.copy{
// Migrate topic ids
            deprecatedFollowedTopicIds.clear()
            deprecatedFollowedTopicIds.addAll(
                currentData.deprecatedIntFollowedTopicIdsList.map(Int::toString),
            )
            deprecatedIntFollowedTopicIds.clear()

            // Migrate author ids
            deprecatedFollowedAuthorIds.clear()
            deprecatedFollowedAuthorIds.addAll(
                currentData.deprecatedIntFollowedAuthorIdsList.map(Int::toString),
            )
            deprecatedIntFollowedAuthorIds.clear()

            // Mark migration as complete
            hasDoneIntToStringIdMigration = true
}

override suspend fun shouldMigrate(currentData: UserPreferences): Boolean =
        !currentData.hasDoneIntToStringIdMigration
}

```

`DataMigration` ë¡œ `UserPreferences` ë¥¼ ë°˜í™˜í•˜ëŠ” ê°ì²´ì¸ë° 

`DataMigration` ì€ ì›ë˜ SharedPreferenceë¥¼ ë§ˆì´ê·¸ë ˆì´ì…˜ í•˜ëŠ” í´ë˜ìŠ¤ì¸ë° datastoreì—ì„œ datastoreë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ë„ ê°€ëŠ¥í•´ì ¸ì„œ niaì—ì„œ ë²„ì „ê³¼ userDataë¥¼ ì €ì¥í•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ”ê±°ê°™ë‹¤. `DataMigration` ì€`cleanUp`,`migrate`,`shouldMigrate`ì´ ì„¸ê°€ì§€ í•¨ìˆ˜ë¥¼ ê°–ëŠ”ë‹¤. ê°ê° `cleanUp`ì€ ì´ì „ ë°ì´í„°ë¥¼ ì§€ìš°ê¸° ìœ„í•œ í•¨ìˆ˜

`migrate`ì€ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ í•˜ëŠ” ê³¼ì •ì„ ì •ì˜í•˜ëŠ” ë¶€ë¶„ì´ê³  

`shouldMigrate`ì€ ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ê°€ëŠ¥í•œì§€ë¥¼ í™•ì¸í•œë‹¤.

ì´ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°ì²´ì˜ ëª©ì ì€ ì €ì¥ëœ IDë¥¼ UserPreferences ë°ì´í„° êµ¬ì¡°ì˜ Int ìœ í˜•ì—ì„œ String ìœ í˜•ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ê²ƒì´ë‹¤.

nia ì†ŒìŠ¤ì½”ë“œëŒ€ë¡œ ë³¸ë‹¤ë©´ ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ìµœì‹  ë°ì´í„°ë¥¼ ë°›ê³  ê¸°ì¡´ `deprecatedFollowedTopicIds` ë¥¼ ì§€ìš°ê³  ìµœì‹  ë°ì´í„°ì˜ ë¦¬ìŠ¤íŠ¸ì—ì„œ Int íƒ€ì…ì„ Stringìœ¼ë¡œ ì €ì¥í•œë‹¤. ìœ„ ë°©ì‹ëŒ€ë¡œ author idë„ ìµœì‹ í™” í•˜ê³  ë§ˆì´ê·¸ë ˆì´ì…˜ ëë‚¬ë‹¤ëŠ” flagë¥¼ ìˆ˜ì •í•˜ê³  ëë‚¸ë‹¤.

í•´ë‹¹ í´ë˜ìŠ¤ëŠ” UserPreferencesDataStoreë¥¼ ì£¼ì…í• ë•Œ DataStoreFactoryì—ì„œ ë§Œë“¤ë•Œ ê³„ì† ë“¤ì–´ê°„ë‹¤.

```kotlin
/**
 * Migrates from using lists to maps for user data.
 */
object ListToMapMigration : DataMigration<UserPreferences> {

    override suspend fun cleanUp() = Unit

    override suspend fun migrate(currentData: UserPreferences): UserPreferences =
        currentData.copy{
// Migrate topic id lists
            followedTopicIds.clear()
            followedTopicIds.putAll(
                currentData.deprecatedFollowedTopicIdsList.associateWith{true},
            )
            deprecatedFollowedTopicIds.clear()

            // Migrate author ids
            followedAuthorIds.clear()
            followedAuthorIds.putAll(
                currentData.deprecatedFollowedAuthorIdsList.associateWith{true},
            )
            deprecatedFollowedAuthorIds.clear()

            // Migrate bookmarks
            bookmarkedNewsResourceIds.clear()
            bookmarkedNewsResourceIds.putAll(
                currentData.deprecatedBookmarkedNewsResourceIdsList.associateWith{true},
            )
            deprecatedBookmarkedNewsResourceIds.clear()

            // Mark migration as complete
            hasDoneListToMapMigration = true
}

override suspend fun shouldMigrate(currentData: UserPreferences): Boolean {
        return !currentData.hasDoneListToMapMigration
}
}

```

í•´ë‹¹ ê°ì²´ë„ ìœ„ì™€ ë¹„ìŠ·í•œë° ê²°êµ­ í•˜ê³ ì í•˜ëŠ”ê±´ Listë¥¼ mapìœ¼ë¡œ ë³€í™˜í•´ì„œ user dataì— ì‚¬ìš©í•œë‹¤. 

ë¡œì§ë„ ê±°ì˜ ë˜‘ê°™ë„ bookmark ìµœì‹ í™”ë§Œ ì¶”ê°€ ë˜ì—ˆë‹¤.

```kotlin
/**
 * An[androidx.datastore.core.Serializer] for the[UserPreferences] proto.
 */
class UserPreferencesSerializer @Inject constructor() : Serializer<UserPreferences> {
    override val defaultValue: UserPreferences = UserPreferences.getDefaultInstance()

    override suspend fun readFrom(input: InputStream): UserPreferences =
        try {
            // readFrom is already called on the data store background thread
            @Suppress("BlockingMethodInNonBlockingContext")
            UserPreferences.parseFrom(input)
        } catch (exception: InvalidProtocolBufferException) {
            throw CorruptionException("Cannot read proto.", exception)
        }

    override suspend fun writeTo(t: UserPreferences, output: OutputStream) {
        // writeTo is already called on the data store background thread
        @Suppress("BlockingMethodInNonBlockingContext")
        t.writeTo(output)
    }
}

```

Serializerì˜ ê¸°ëŠ¥ì€ proto íƒ€ì…ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ dataStoreì—ì„œ read, writeê¸°ëŠ¥ì„ í•˜ê¸° ìœ„í•œ í´ë˜ìŠ¤ì´ë‹¤.

ë¨¼ì € `defaultValue`ë¥¼ overrideë˜ì–´ ê°’ì„ ë°˜í™˜ í•´ì¤˜ì•¼í•˜ëŠ”ë° ê·¸ëƒ¥ ê°„ë‹¨í•˜ê²Œ getDefaultInstanceë¥¼ í˜¸ì¶œí•œë‹¤. ê·¼ë° ì–´ë–»ê²Œ ê·¸ëƒ¥ default ê°’ì„ ê°–ëƒë©´ protoì—ì„œ javaë¡œ ìƒì„±í• ë•Œ ëª¨ë“  í•„ë“œì— ëŒ€í•œ ê¸°ë³¸ ê°’ì„ ìë™ìœ¼ë¡œ ë„£ëŠ”ë° ì´ê±¸ í˜¸ì¶œí•˜ëŠ” ê²ƒì´ë‹¤. í•´ë‹¹ í•¨ìˆ˜ëŠ” ê°ì²´ ë¹Œë“œë¥¼ ìœ„í•œ ì‹œì‘ì ìœ¼ë¡œ ì‚¬ìš©í•˜ê±°ë‚˜ ë°ì´í„°ê°€ ì†ìƒë˜ì—ˆì„ë•Œ ì—­ì§ì—´í™”ë¥¼ í•  í´ë°±ìœ¼ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

`readFrom`ëŠ” ë§ê·¸ë˜ë„ ì½ëŠ” ë¶€ë¶„ì´ê³  `writeTo` ì“°ëŠ” ë¶€ë¶„ì´ë¼ íŠ¹ë³„í•œê±´ ì—†ë‹¤.

```kotlin

class NiaPreferencesDataSource @Inject constructor(
    private val userPreferences: DataStore<UserPreferences>,
) {
    val userData = userPreferences.data
        .map{
UserData(
                bookmarkedNewsResources =it.bookmarkedNewsResourceIdsMap.keys,
                followedTopics =it.followedTopicIdsMap.keys,
                themeBrand = when (it.themeBrand) {
                    null,
                    ThemeBrandProto.THEME_BRAND_UNSPECIFIED,
                    ThemeBrandProto.UNRECOGNIZED,
                    ThemeBrandProto.THEME_BRAND_DEFAULT,
                    -> ThemeBrand.DEFAULT
ThemeBrandProto.THEME_BRAND_ANDROID-> ThemeBrand.ANDROID
},
                darkThemeConfig = when (it.darkThemeConfig) {
                    null,
                    DarkThemeConfigProto.DARK_THEME_CONFIG_UNSPECIFIED,
                    DarkThemeConfigProto.UNRECOGNIZED,
                    DarkThemeConfigProto.DARK_THEME_CONFIG_FOLLOW_SYSTEM,
                    ->
                        DarkThemeConfig.FOLLOW_SYSTEM
DarkThemeConfigProto.DARK_THEME_CONFIG_LIGHT->
                        DarkThemeConfig.LIGHT
DarkThemeConfigProto.DARK_THEME_CONFIG_DARK-> DarkThemeConfig.DARK
},
                useDynamicColor =it.useDynamicColor,
                shouldHideOnboarding =it.shouldHideOnboarding,
            )
}

suspend fun setFollowedTopicIds(topicIds: Set<String>) {
        try {
            userPreferences.updateData{
                it.copy{
followedTopicIds.clear()
                    followedTopicIds.putAll(topicIds.associateWith{true})
updateShouldHideOnboardingIfNecessary()
}
            }
} catch (ioException: IOException) {
            Log.e("NiaPreferences", "Failed to update user preferences", ioException)
        }
    }

    suspend fun toggleFollowedTopicId(topicId: String, followed: Boolean) {
        try {
            userPreferences.updateData{
                it.copy{
if (followed) {
                        followedTopicIds.put(topicId, true)
                    } else {
                        followedTopicIds.remove(topicId)
                    }
updateShouldHideOnboardingIfNecessary()
}
            }
} catch (ioException: IOException) {
            Log.e("NiaPreferences", "Failed to update user preferences", ioException)
        }
    }

    suspend fun setThemeBrand(themeBrand: ThemeBrand) {
        userPreferences.updateData{
            it.copy{
this.themeBrand = when (themeBrand) {
                    ThemeBrand.DEFAULT-> ThemeBrandProto.THEME_BRAND_DEFAULT
ThemeBrand.ANDROID-> ThemeBrandProto.THEME_BRAND_ANDROID
}
}
        }
}

    suspend fun setDynamicColorPreference(useDynamicColor: Boolean) {
        userPreferences.updateData{
            it.copy{
this.useDynamicColor = useDynamicColor
}
        }
}

    suspend fun setDarkThemeConfig(darkThemeConfig: DarkThemeConfig) {
        userPreferences.updateData{
            it.copy{
this.darkThemeConfig = when (darkThemeConfig) {
                    DarkThemeConfig.FOLLOW_SYSTEM->
                        DarkThemeConfigProto.DARK_THEME_CONFIG_FOLLOW_SYSTEM
DarkThemeConfig.LIGHT-> DarkThemeConfigProto.DARK_THEME_CONFIG_LIGHT
DarkThemeConfig.DARK-> DarkThemeConfigProto.DARK_THEME_CONFIG_DARK
}
}
        }
}

    suspend fun toggleNewsResourceBookmark(newsResourceId: String, bookmarked: Boolean) {
        try {
            userPreferences.updateData{
                it.copy{
if (bookmarked) {
                        bookmarkedNewsResourceIds.put(newsResourceId, true)
                    } else {
                        bookmarkedNewsResourceIds.remove(newsResourceId)
                    }
}
            }
} catch (ioException: IOException) {
            Log.e("NiaPreferences", "Failed to update user preferences", ioException)
        }
    }

    suspend fun getChangeListVersions() = userPreferences.data
        .map{
ChangeListVersions(
                topicVersion =it.topicChangeListVersion,
                newsResourceVersion =it.newsResourceChangeListVersion,
            )
}
.firstOrNull() ?: ChangeListVersions()

/**
     * Update the[ChangeListVersions] using[update].
     */
suspend fun updateChangeListVersion(update: ChangeListVersions.() -> ChangeListVersions) {
        try {
            userPreferences.updateData{currentPreferences->
val updatedChangeListVersions = update(
                    ChangeListVersions(
                        topicVersion = currentPreferences.topicChangeListVersion,
                        newsResourceVersion = currentPreferences.newsResourceChangeListVersion,
                    ),
                )

                currentPreferences.copy{
topicChangeListVersion = updatedChangeListVersions.topicVersion
                    newsResourceChangeListVersion = updatedChangeListVersions.newsResourceVersion
}
            }
} catch (ioException: IOException) {
            Log.e("NiaPreferences", "Failed to update user preferences", ioException)
        }
    }

    suspend fun setShouldHideOnboarding(shouldHideOnboarding: Boolean) {
        userPreferences.updateData{
            it.copy{
this.shouldHideOnboarding = shouldHideOnboarding
}
        }
}
}

private fun UserPreferencesKt.Dsl.updateShouldHideOnboardingIfNecessary() {
    if (followedTopicIds.isEmpty() && followedAuthorIds.isEmpty()) {
        shouldHideOnboarding = false
    }
}

```

ì´ì œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ì €ì¥í•˜ëŠ” ë¡œì§ì„ DataSourceí˜•ì‹ìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” í´ë˜ìŠ¤ì´ë‹¤.

ëª¨ë‘ userPreferenceë¥¼ ì‚¬ìš©í•˜ì—¬ getê³¼ setì„ í•´ì¤€ë‹¤.

## DI

```kotlin
@Module
@InstallIn(SingletonComponent::class)
object DataStoreModule {

    @Provides
    @Singleton
    fun providesUserPreferencesDataStore(
        @ApplicationContext context: Context,
        @Dispatcher(IO) ioDispatcher: CoroutineDispatcher,
        userPreferencesSerializer: UserPreferencesSerializer,
    ): DataStore<UserPreferences> =
        DataStoreFactory.create(
            serializer = userPreferencesSerializer,
            scope =CoroutineScope(ioDispatcher +SupervisorJob()),
            migrations =listOf(
                IntToStringIdsMigration,
            ),
        ){
context.dataStoreFile("user_preferences.pb")
}
}

```

ë‹¤ë¥¸ di ëª¨ë“ˆì„ ë³´ë©´ í¬ê²Œ ë‹¤ë¥¸ê±´ ì—†ë‹¤. Dispatcherë¥¼ ìƒì„±ìë¡œ ë°›ê³  *`SupervisorJob`* ìœ¼ë¡œ ë¹„ë™ê¸°í™” í•˜ê³  ë°ì´í„°ë¥¼ ì½ê³  ì“°ëŠ”ê±° ê°™ë‹¤.

SupervisorJobì€ ì—ëŸ¬ì˜ ì „íŒŒ ë°©í–¥ì„ ìì‹ìœ¼ë¡œ í•œì • ì§“ëŠ” ê¸°ëŠ¥ì„ í•œë‹¤. ê·¸ë˜ì„œ ìì‹ ì½”ë£¨í‹´ì—ì„œ ì—ëŸ¬ê°€ ë°œìƒí–ˆì„ ê²½ìš° ë¶€ëª¨ê¹Œì§€ ì˜í–¥ì„ ë°›ëŠ”ê²Œ ì•„ë‹ˆë¼ ì—ëŸ¬ë‚œ ìì‹ ì½”ë£¨í‹´ë§Œ ì˜í–¥ì„ í•œì •ì‹œí‚¨ë‹¤.

datastoreëŠ” ì‚¬ì‹¤ ì´ì „ í”„ë¡œì íŠ¸ë¥¼ í•˜ë©´ì„œ ë¯¸ë¦¬ ê³µë¶€í•´ì„œ í¬ê²Œ ìƒˆë¡œìš´ê±´ ì—†ì—ˆë‹¤. 

ë‚´ìš©ì´ ì§§ì•„ì„œ model ëª¨ë“ˆë„ ë³´ì.

## Model

í´ë˜ìŠ¤ê°€ ì—¬ëŸ¿ìˆì§€ë§Œ ë‹¤ ì´ë¯¸ networkë‚˜ database, datastoreì—ì„œ ë³¸ modelë“¤ì´ë‹¤.

ì—¬ê¸°ì„  ë”±íˆ ì†ŒìŠ¤ë¥¼ ë³´ë©´ì„œ ì–˜ê¸°í•˜ì§€ì•Šê³  ì•„í‚¤í…ì²˜ë¥¼ ì–˜ê¸°í•´ë³´ë ¤ê³  í•œë‹¤.

ìœ„ì— ì–˜ê¸°í•œëŒ€ë¡œ network, database, datastoreì—ì„œ ì‚¬ìš©í•œ ëª¨ë¸ë“¤ì¸ë° ì™œ ë”°ë¡œ ëª¨ë“ˆì„ ë§Œë“¤ì–´ì„œ ê´€ë¦¬í•˜ë‚˜ í–ˆëŠ”ë° ë‚´ ìƒê°ì—ëŠ” ì´ ëª¨ë“ˆì„ ì‚¬ìš©í•´ì„œ ì˜ì¡´ì„± ë¶„ë¦¬ë¥¼ í•˜ëŠ”ê±°ê°™ë‹¤. nia ê¹ƒí—ˆë¸Œì— ì˜ì¡´ì„± ê·¸ë˜í”„ë¥¼ ë³´ë©´ í•´ë‹¹ ëª¨ë“ˆë“¤ì€ ëª¨ë‘ Model ëª¨ë“ˆì„ ì˜ì¡´í•˜ëŠ”ë° Modelì€ ì–´ë–¤ ëª¨ë“ˆë„ ì˜ì¡´í•˜ì§€ ì•ŠëŠ”ë° í•´ë‹¹ ê·¸ë˜í”„ë“¤ì„ ë³´ë©´ì„œ ìƒê°ì´ ë“ ê±´ networkë‚˜ ë‹¤ë¥¸ ëª¨ë“ˆì— ì§ì ‘ì ìœ¼ë¡œ ì˜ì¡´í• ìˆ˜ë„ ìˆì§€ë§Œ ê·¸ë ‡ê²Œ í•  ê²½ìš° ì˜ì¡´ì„±ì´ ë†’ì•„ì§€ê³  í™•ì¥ì— ë°©í•´ê°€ ë ê±¸ ìš°ë ¤í•´ ë¯¸ë¦¬ ë¶„ë¦¬í•œê±°ê°™ë‹¤ Modelì€ í™•ì¥ ë˜ë”ë¼ë„ ê°’ì„ ì¶”ê°€í•˜ë©´ ë˜ë‹ˆ í¬ê²Œ ì˜í–¥ë„ë„ ì ì„ê²ƒì´ë‹¤. ê·¸ë¦¬ê³  Modelì˜ ì˜ì¡´í•˜ëŠ”ê±´ dataë¶€ë¶„ë“¤ë§Œ ê·¸ëŸ°ê²Œ ì•„ë‹ˆë¼ ui layerì—ì„œë„ ì˜ì¡´í•˜ë©´ì„œ data â†” model â†” ui íë¦„ìœ¼ë¡œ ì˜ì¡´í•˜ê³  íë¥¸ë‹¤. ì •í™•íˆëŠ” domainë„ ìˆì§€ë§Œ ì—¬ê¸°ê¹Œì§€ë§Œ ë³´ë©´ ê·¸ë ‡ê²Œ ëœë‹¤.

## ëŠë‚€ì 
datastoreëŠ” ë³¼ë•Œë§ˆë‹¤ proto ë•Œë¬¸ì¸ì§€ ë¨¸ë¦¬ê°€ ì–´ì§ˆì–´ì§ˆí•˜ë‹¤. ê·¸ë˜ë„ ì–´ë µì§€ëŠ” ì•Šì•„ì„œ ì´í•´ëŠ” ê¸ˆë°© ë˜ì—ˆë‹¤.
ê·¸ë¦¬ê³  ëª¨ë“ˆì„ ë‚˜ëˆ„ëŠ” ë°©ì‹ì€ ì •ë§ íšŒì‚¬ë§ˆë‹¤ ë‹¤ ë‹¤ë¥´ë‹¤ëŠ”ê±¸ ëŠê¼ˆë‹¤.
ë‚œ model ë§Œ ë”°ë¡œ ë¹¼ì„œ ê´€ë¦¬í•  ìƒê°ì€ ë„ˆë¬´ ë¶ˆí¸í• ê±°ê°™ì•˜ëŠ”ë° ì§ì ‘ ë³´ë‹ˆ ìƒê°ë³´ë‹¤ ê°„í¸í•´ë³´ì˜€ë‹¤.
ë¬¼ë¡  í”„ë¡œì íŠ¸ê°€ ì»¤ì§€ë©´ í˜ë“¤ê² ì§€ë§Œ ê·¸ë˜ë„ ë‚˜ì˜ì§€ ì•Šì•„ë³´ì¸ë‹¤.
ë‹¤ìŒ í† ì´ í”„ë¡œì íŠ¸ë•ŒëŠ” ì ìš©í•´ ë³¼ìˆ˜ë„ ìˆì„ê±°ê°™ë‹¤

## ë‚´ì¼ í•  ì¼
niaì˜ comonì„ ë³´ì.